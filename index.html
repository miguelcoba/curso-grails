<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>Grails Intro</title>

    <meta name="description" content="Grails Intro">
    <meta name="author" content="Miguel CobÃ¡">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="revealjs/css/reveal.min.css">
    <link rel="stylesheet" href="revealjs/css/theme/default.css" id="theme">

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="revealjs/lib/css/zenburn.css">

    <!-- If the query includes 'print-pdf', use the PDF print sheet -->
    <script>
      document.write( '<link rel="stylesheet" href="revealjs/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
    </script>

    <!--[if lt IE 9]>
    <script src="revealjs/lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">
        <section>
          <h1>Grails</h1>
        </section>

        <section>
          <h2>Grails features</h2>
          <ul>
            <li class="fragment">Full stack framework + plugins</li>
            <li class="fragment">Groovy language</li>
            <li class="fragment">Convention over configuration</li>
            <li class="fragment">Object Relational Mapping (GORM) build on top of Hibernate</li>
            <li class="fragment">View technology (GSPs)</li>
            <li class="fragment">Controller layer built on Spring MVC</li>
            <li class="fragment">Embedded Tomcat</li>
            <li class="fragment">Dependency Injection with Spring</li>
            <li class="fragment">i18n support</li>
          </ul>
  
          <aside class="notes">
            Grails features
          </aside>
        </section>

        <section>
          <h2>Grails 2.1</h2>
        </section> 
  
        <section>
          <h2>Java setup</h2>
          <ol>
            <li class="fragment">http://www.oracle.com/technetwork/java/javase/downloads/index.html</li>
            <li class="fragment">Java SE Development Kit 7u21</li>
            <li class="fragment">Crear variable de ambiente JAVA_HOME</li>
            <li class="fragment">(Windows) Agregar %JAVA_HOME%\bin al PATH</li>
            <li class="fragment">(GNU/Linux) Agregar $JAVA_HOME/bin al PATH</li>
          </ol>
        </section> 

        <section>
          <h2>Grails setup</h2>
          <ol>
            <li class="fragment">http://grails.org/download</li>
            <li class="fragment">Grails 2.1.0</li>
            <li class="fragment">Unzip to C:\grails-2.1.0</li>
            <li class="fragment">Create GRAILS_HOME environment variable</li>
            <li class="fragment">(Windows) Add %GRAILS_HOME%\bin to PATH</li>
            <li class="fragment">(GNU/Linux) Add $GRAILS_HOME/bin to PATH</li>
          </ol>
        </section> 

        <section>
          <h2>Test grails installation</h2>
          <pre><code class="language-bash" data-trim>
$ grails -version

Grails version: 2.1.0
          </code></pre>
        </section>

        <section>
          <h2>Create application</h2>
          <pre><code class="language-bash" data-trim>
$ grails create-app tutorial
$ cd tutorial
          </code></pre>
        </section>

        <section>
          <h2>Create controller</h2>
          <pre><code class="language-bash" data-trim>
$ grails create-controller hello
          </code></pre>
        </section>

        <section>
          <p>grails-app/controllers/tutorial/HelloController.groovy</p>
          <pre><code data-trim>
package tutorial

class HelloController {
  def world = {
    render "Hello World!"
  }
}
          </code></pre>
        </section>

        <section>
          <h2>Run application</h2>
          <pre><code class="language-bash" data-trim>
$ grails run-app
          </code></pre>
        </section>

        <section>
          <h2>Access application</h2>
          <p><a href="http://localhost:8080/tutorial">http://localhost:8080/tutorial</a></p>
        </section>

        <section>
          <section>
            <h2>Integrated Development Environments</h2>
          </section>
          <section>
            <h3>IntelliJ IDEA</h3>
            <p><a href="http://www.jetbrains.com/idea">http://www.jetbrains.com/idea</a></p>
            <pre><code class="language-bash" data-trim>
$ grails integrate-with --intellij
            </code></pre>
          </section>
          <section>
            <h3>NetBeans</h3>
            <p><a href="http://netbeans.org">http://netbeans.org</a></p>
          </section>
          <section>
            <h3>Eclipse</h3>
            <p><a href="http://eclipse.org">http://eclipse.org</a></p>
          </section>
          <section>
            <h3>Spring Tool Suite</h3>
            <p><a href="http://spring.io/tools/sts">http://spring.io/tools/sts</a></p>
          </section>
          <section>
            <h3>Groovy/Grails Tool Suite</h3>
            <p><a href="http://spring.io/tools/ggts">http://spring.io/tools/ggts</a></p>
          </section>
          <section>
            <h3>TextMate</h3>
            <p><a href="http://macromates.com/">http://macromates.com</a></p>
            <pre><code class="language-bash" data-trim>
$ grails integrate-with --textmate
            </code></pre>
          </section>
          <section>
            <h3>Sublime Text</h3>
            <p><a href="http://www.sublimetext.com/">http://www.sublimetext.com/</a></p>
          </section>
        </section>

        <section>
          <h2>Grails directory structure</h2>
          <pre><code data-trim>
grails-app     - top level app dir
  conf         - Configuration files
  controllers  - web controllers
  domain       - application domain models
  i18n         - i18n resource files
  services     - services layer
  taglib       - custom tag libraries
  views        - Groovy Server Pages
scripts        - scripts for grails
src            - Supporting sources
test           - unit, integration and functional tests
          </code></pre>
        </section>

        <section>
          <h1>Grails commands</h1>
        </section>

        <section>
          <h2>Running a Grails application</h2>
          <pre><code data-trim>
$ grails run-app
          </code></pre>
        </section>

        <section>
          <h2>Testing a Grails application</h2>
          <pre><code data-trim>
$ grails test-app
          </code></pre>
        </section>

        <section>
          <h2>Deploying a Grails application</h2>
          <pre><code data-trim>
$ grails war
          </code></pre>
        </section>

        <section>
          <h2>Scaffolding</h2>
          <pre><code data-trim>
$ grails generate-all tutorial.Hello
          </code></pre>
          <ul>
            <li>generates skeleton code
              <ul>
                <li>controller</li>
                <li>views</li>
              </ul>
            </li>
            <li>it SHOULD always be customized</li>
            <li>it is <span class="fragment highlight-red">only</span> a starting point</li>
          </ul>
        </section>

        <section>
          <h2>Creating artifacts</h2>
          <pre><code class="language-bash" data-trim>
$ grails create-controller
$ grails create-domain-class
$ grails create-unit-test
$ grails create-tag-lib
          </code></pre>
        </section>

        <section>
          <h1>Configuration</h1>
        </section>

        <section>
          <h2>Basic configuration</h2>
          <p>grails/conf/Config.groovy</p>
        </section>

        <section>
          <h2>Custom configuration</h2>
          <p>Set values</p>
          <pre><code data-trim>
my.app.value = "some value"
          </code></pre>
 
          <p>Read values (in controllers/services/taglibs)</p>
          <pre><code data-trim>
grailsApplication.config.my.app.value
          </code></pre>

          <pre><code data-trim>
import org.codehaus.groovy.grails.commons.*

CodeHolder.config.my.app.hello
          </code></pre>
        </section>

        <section>
          <h2>Logging</h2>
          <pre><code data-trim>
log4j = {
  error 'com.example.package1', 'com.example.package2'
  warn 'com.example.package3'
}
          </code></pre>
        </section>

        <section>
          <section>
            <h2>Logging packages</h2>
          </section>
          <section>
            <p>Class loading</p>
            <pre><code data-trim>
org.codejaus.groovy.grails.commons
            </code></pre>
          </section>
          <section>
            <p>Web request processing</p>
            <pre><code data-trim>
org.codejaus.groovy.grails.web
            </code></pre>
          </section>
          <section>
            <p>URL mapping</p>
            <pre><code data-trim>
org.codejaus.groovy.grails.web.mapping
            </code></pre>
          </section>
          <section>
            <p>Plugin activity</p>
            <pre><code data-trim>
org.codejaus.groovy.grails.plugins
            </code></pre>
          </section>
          <section>
            <p>Spring activity</p>
            <pre><code data-trim>
org.springframework
            </code></pre>
          </section>
          <section>
            <p>Hibernate activity</p>
            <pre><code data-trim>
org.hibernate
            </code></pre>
          </section>
        </section>

        <section>
          <h2>GORM</h2>
          <pre><code data-trim>
grails.gorm.failOnError = true

  throws Exception on validation failure on save() method

grails.gorm.autoFlush = true

  to force flushing of Hibernate session on save(), delete(), merge() methods
          </code></pre>
        </section>

        <section>
          <h1>Environments</h1>
        </section>

        <section>
          <h2>Per environment configuration</h2>
          <p>Config files</p>
          <p>Application code</p>
        </section>

        <section>
          <h2>Preset</h2>
          <ul>
            <li>dev</li>
            <li>test</li>
            <li>prod</li>
          </ul>
        </section>

        <section>
          <h2>Environments in command line</h2>
          <pre><code class="language-bash" data-trim>
grails [environment] [command name]
grails run-app        // runs app in default mode (default is dev)
grails prod run-app   // runs app in production mode
grails test war       // creates war for the test environment
          </code></pre>
        </section>

        <section>
          <h2>Programmatic environment detection</h2>
          <pre><code data-trim>
import grails.util.Environment

switch(Environment.current) {
  case Environment.DEVELOPMENT:
    someConfigForDev()
    break
  case Environment.PRODUCTION:
    someConfigForProd()
    break
}
          </code></pre>
        </section>

        <section>
          <h2>Per environment bootstrap</h2>
          <pre><code data-trim>
def init = { ServletContext ctx ->
  environments {
    production {
      ctx.setAttribute("env", "prod")
    }
    development {
      someConfigForDev()
    }
  }
  someConfigForAllEnvironments()
}
          </code></pre>
        </section>

        <section>
          <h2>Environments in application code</h2>
          <pre><code data-trim>
import grails.util.Environment

Environment.executeForCurrentEnvironment {
  production {
    someConfig()
  }
  development {
    someOtherConfig()
  }
}
          </code></pre>
        </section>

        <section>
          <h1>DataSource</h1>
        </section>

        <section>
          <h2>JDBC</h2>
          <ul>
            <li>put jar in grails project lib/ directory</li>
            <li>environment aware</li>
            <li>use a runtime dependency</li>
          <pre><code data-trim>
dependencies {
  // mysql
  runtime 'mysql:mysql-connector-java:5.1.5'
  // sqlserver
  runtime 'net.sourceforge.jtds:jtds:1.2.4'
}
          </code></pre>
        </section>

        <section>
          <h2>JDBC Configuration</h2>
          <ul>
            <li>driverClassName</li>
            <li>username</li>
            <li>password</li>
            <li>url</li>
            <li>dbCreate</li>
            <li>pooled</li>
            <li>logSql</li>
            <li>dialect</li>
            <li>properties </li>
            <li>jndiName</li>
          </ul>
        </section>

        <section>
          <h2>Configuration example</h2>
          <pre><code data-trim>
dataSource {
  pooled = true
  dbCreate = "update"
  url = "jdbc:mysql://localhost/yourDB"
  driverClassName = "com.mysql.jdbc.Driver"
  dialect = org.hibernate.dialect.MySQL5InnoDBDialect
  username = "yourUser"
  password = "yourPassword"
  properties {
    maxActive = 50
      maxIdle = 25
      minIdle = 5
      initialSize = 5
      minEvictableIdleTimeMillis = 60000
      timeBetweenEvictionRunsMillis = 60000
      maxWait = 10000
      validationQuery = "/* ping */"
  }
}
          </code></pre>
        </section>

        <section>
          <h2>Externalized configuration</h2>
          <pre><code data-trim>
grails.config.locations = [
  "classpath:${appName}-config.properties",
  "classpath:${appName}-config.groovy",
  "file:${userHome}/.grails/${appName}-config.properties",
  "file:${userHome}/.grails/${appName}-config.groovy"
]

read:                           
  grailsApplication
          </code></pre>
        </section>

        <section>
          <h2>Versioning</h2>
          <pre><code data-trim>
// set
$ grails set-version 0.99
application.properties

// read in controllers
def version = grailsApplication.metadata['app.version']
def grailsVer = grailsApplication.metadata['app.grails.version']

def version = grails.util.GrailsUtil.grailsVersion
            </code></pre>
        </section>

        <section>
          <h2>Documentation</h2>
          <p>Textile variation</p>
          <pre><code data-trim>
src/doc/guide/1. first chapter.gdoc
src/doc/guide/2. this will be the second chapter.gdoc
          </code></pre>

          <pre><code class="language-bash" data-trim>
$ grails doc    # generate documentation
          </code></pre>
        </section>

        <section>
          <section>
            <h2>Dependency resolution</h2>
          </section>
          <section>
            <h2>Repositories</h2>
            <ul>
              <li>maven</li>
              <li>directory</li>
            </ul>
          </section>
          <section>
            <h3>Scope</h3>
            <ul>
              <li>build</li>
              <li>compile</li>
              <li>runtime</li>
              <li>test</li>
              <li>provided</li>
            </ul>
          </section>
        </section>

        <section>
          <h2>Configuration</h2>
          <pre><code data-trim>
// group:name:version
runtime "com.mysql:mysql-connector-java:5.1.5"
runtime(group: 'com.mysql', 
        name: 'mysql-connector-java',
        version: '5.1.5')

// plugin dependencies
plugins {
  test ':spock:0.5-groovy'
  runtime ':jquery:1.4.2.7'
}
          </code></pre>
        </section>

        <section>
          <h1>Command line</h1>
        </section>

        <section>
          <section>
            <h1>Gant</h1>
          </section>
          <section>
            <h2>Groovy wrapper around Apache Ant</h2>
          </section>
          <section>
            <h2>Search locations</h2>
            <pre><code class="language-bash" data-trim>
USER_HOME/.grails/scripts
PROJECT_HOME/scripts
PROJECT_HOME/plugins/*/scripts
GRAILS_HOME/scripts
            </code></pre>
          </section>
          <section>
            <h2>Example</h2>
            <p>Script</p>
            <pre><code data-trim>
$ grails run-app
            </code></pre>

            <p>Searches</p>
            <pre><code class="language-bash" data-trim>
USER_HOME/.grails/scripts/RunApp.groovy
PROJECT_HOME/scripts/RunApp.groovy
PLUGINS_HOME/*/scripts/RunApp.groovy
GLOBAL_PLUGINS_HOME/*/scripts/RunApp.groovy
GRAILS_HOME/scripts/RunApp.groovy
            </code></pre>
          </section>
        </section>

        <section>
          <section>
            <h1>Ant and Maven</h1>
          </section>
          <section>
            <h2>Ant integration</h2>
            <pre><code data-trim>
$ grails integrate-with --ant 
build.xml
            </code></pre>
            <h2>Targets</h2>
            <ul>
              <li>clean</li>
              <li>compile</li>
              <li>test</li>
              <li>run</li>
              <li>war</li>
              <li>deploy</li>
            </ul>
          </section>
          <section>
            <h2>Maven integration</h2>
            <pre><code data-trim>
$ grails create-pom com.mycompany
pom.xml
            </code></pre>
            <h2>Targets</h2>
            <ul>
              <li>compile</li>
              <li>package</li>
              <li>install</li>
              <li>test</li>
              <li>clean</li>
              <li>grails:create-controller</li>
              <li>grails:create-domain-class</li>
              <li>grails:create-integration-test</li>
            </ul>
          </section>
        </section>

        <section>
          <h1>GORM</h1>
        </section>

        <section>
          <h2>Domain classes</h2>
          <ul>
            <li>hold state about business processes</li>
            <li>implement behavior</li>
            <li>relationships between domain classes
              <ul>
                <li>one-to-one</li>
                <li>one-to-many</li>
              </ul>
            </li>
          </ul>
        </section>

        <section>
          <h2>GORM</h2>
          <ul>
            <li>Grails' Object Relational Mapping (ORM)</li>
            <li>Hibernate 3</li>
					</ul>
        </section>

        <section>
          <h2>Create DB - MySQL</h2>
          <pre><code data-trim>
mysql -u root -p
create database tutorial;
create user tutorial@localhost identified by 'tutorial';
grant all on tutorial.* to tutorial@localhost;
          </code></pre>
        </section>

        <section>
          <h2>Config DB Connection</h2>
          <pre><code data-trim>
grails-app/conf/DataSource.groovy:

environments {
  development {
    dataSource {
      dbCreate = "create-drop" // one of 'create', 'create-drop','update'
      //loggingSql = true
      url = "jdbc:mysql://localhost/tutorial"
      driverClassName = "com.mysql.jdbc.Driver"
      dialect = org.hibernate.dialect.MySQL5InnoDBDialect
      username = "tutorial"
      password = "tutorial"
    }
  }
}
          </code></pre>
        </section>

        <section>
          <h2>Enable Maven remote</h2>
          <pre><code data-trim>
grails-app/conf/BuildConfig.groovy:

mavenCentral()
          </code></pre>
        </section>

        <section>
          <h2>Add dependency</h2>
          <pre><code data-trim>
grails-app/conf/BuildConfig.groovy:

dependencies {
  runtime 'mysql:mysql-connector-java:5.1.5'
}
          </code></pre>
        </section>

        <section>
          <h2>Demo</h2>
          <pre><code data-trim>
$ grails create-app tutorial        // default package: tutorial

$ grails create-domain-class Person
          </code></pre>
        </section>

        <section>
          <h3>grails-app/domain/tutorial/Person.groovy</h3>
          <pre><code data-trim>
package tutorial

class Person {

  static constraints = {
  }
}
          </code></pre>
        </section>

        <section>
          <h3>grails-app/domain/tutorial/Person.groovy</h3>
          <pre><code data-trim>
package tutorial

class Person {
  String name
  Integer age
  Date lastVisit

  static constraints = {
  }
}
          </code></pre>
        </section>

        <section>
          <h2>Example</h2>
          <pre><code data-trim>
// grails console
import tutorial.*

// save
def p = new Person(name: 'Miguel', age: 31, lastVisit: new Date())
p.save()

// read
p = Person.get(1)
println p.name

// update
p = Person.get(1)
p.name = "Bob"
p.save()

// delete
p = Person.get(1)
p.delete()

// list
def l = Person.list()
l.each {
  println "name:${it.name}, age:${it.age}, lastVisit:${it.lastVisit}"
}
          </code></pre>
        </section>

        <section>
          <h1>Relationships</h1>
        </section>

        <section>
          <h2>Relationship</h2>
          <ul>
            <li>define how domain classes interact with each other</li>
            <li>unless specified in both ends, exists only in the direction it is defined</li>
          </ul>
        </section>

        <section>
          <h2>Cardinality</h2>
          <ul>
            <li>one-to-one</li>
            <li>one-to-many</li>
            <li>many-to-many</li>
          </ul>
        </section>

        <section>
          <h2>Direction</h2>
          <ul>
            <li>unidirectional</li>
            <li>bidirectional</li>
          </ul>
        </section>

        <section>
          <h2>Example domain classes</h2>
          <pre><code data-trim>
$ grails create-domain-class Face
$ grails create-domain-class Nose
$ grails create-domain-class Book
$ grails create-domain-class Author
          </code></pre>
        </section>

        <section>
          <h2>one-to-one 1</h2>
          <pre><code data-trim>
class Face {
  Nose nose       // property
}
class Nose {
}
          </code></pre>
          <ul>
            <li>Defined using <strong>a property</strong> of the type of another domain class</li>
            <li>unidirectional (Face -> Nose)</li>
            <li>many-to-one (many faces can have a given nose)</li>
          </ul>
        </section>

        <section>
          <h2>Database</h2>
          <pre><code data-trim>
mysql> describe face;
+---------+------------+------+-----+---------+----------------+
| Field   | Type       | Null | Key | Default | Extra          |
+---------+------------+------+-----+---------+----------------+
| id      | bigint(20) | NO   | PRI | NULL    | auto_increment |
| version | bigint(20) | NO   |     | NULL    |                |
| nose_id | bigint(20) | NO   | MUL | NULL    |                |
+---------+------------+------+-----+---------+----------------+

mysql> describe nose;
+---------+------------+------+-----+---------+----------------+
| Field   | Type       | Null | Key | Default | Extra          |
+---------+------------+------+-----+---------+----------------+
| id      | bigint(20) | NO   | PRI | NULL    | auto_increment |
| version | bigint(20) | NO   |     | NULL    |                |
+---------+------------+------+-----+---------+----------------+
          </code></pre>
        </section>

        <section>
          <h2>one-to-one 2</h2>
          <pre><code data-trim>
class Face {
  Nose nose
  static constraints = {
    nose unique: true
  }
}
class Nose {
}
          </code></pre>
          <ul>
            <li>unidirectional (Face -> Nose)</li>
            <li>one-to-one (A nose can only be in one face)</li>
          </ul>
        </section>

        <section>
          <h2>Database</h2>
          <pre><code data-trim>
mysql> describe face;
+---------+------------+------+-----+---------+----------------+
| Field   | Type       | Null | Key | Default | Extra          |
+---------+------------+------+-----+---------+----------------+
| id      | bigint(20) | NO   | PRI | NULL    | auto_increment |
| version | bigint(20) | NO   |     | NULL    |                |
| nose_id | bigint(20) | NO   | UNI | NULL    |                |
+---------+------------+------+-----+---------+----------------+

mysql> describe nose;
+---------+------------+------+-----+---------+----------------+
| Field   | Type       | Null | Key | Default | Extra          |
+---------+------------+------+-----+---------+----------------+
| id      | bigint(20) | NO   | PRI | NULL    | auto_increment |
| version | bigint(20) | NO   |     | NULL    |                |
+---------+------------+------+-----+---------+----------------+
          </code></pre>
        </section>

        <section>
          <h2>one-to-one 3</h2>
          <pre><code data-trim>
class Face {
  Nose nose
}
class Nose {
  static belongsTo = [ face:Face ]
}
          </code></pre>
          <ul>
            <li>bidirectional (Face <-> Nose)</li>
            <li>many-to-one (Many faces can have a given nose)</li>
          </ul>
        </section>

        <section>
          <h2>Database</h2>
          <pre><code data-trim>
mysql> describe face;
+---------+------------+------+-----+---------+----------------+
| Field   | Type       | Null | Key | Default | Extra          |
+---------+------------+------+-----+---------+----------------+
| id      | bigint(20) | NO   | PRI | NULL    | auto_increment |
| version | bigint(20) | NO   |     | NULL    |                |
| nose_id | bigint(20) | NO   | MUL | NULL    |                |
+---------+------------+------+-----+---------+----------------+

mysql> describe nose;
+---------+------------+------+-----+---------+----------------+
| Field   | Type       | Null | Key | Default | Extra          |
+---------+------------+------+-----+---------+----------------+
| id      | bigint(20) | NO   | PRI | NULL    | auto_increment |
| version | bigint(20) | NO   |     | NULL    |                |
+---------+------------+------+-----+---------+----------------+
          </code></pre>
        </section>

        <section>
          <h2>Behavior</h2>
          <h3>insert/updates cascade from Face to Nose</h3>
          <pre><code data-trim>
// Nose is saved automatically
new Face(nose: new Nose()).save() 
          </code></pre>

          <h3>the inverse ins't true</h3>
          <pre><code data-trim>
// Won't work. Face is transient
new Nose(face: new Face()).save()
          </code></pre>

          <h3>deletes are cascaded too!</h3>
          <pre><code data-trim>
def f = new Face(1)
f.delete()        // Face and Nose are deleted
          </code></pre>
 
          <h3>foreign key stored in _parent_ (Face) as nose_id</h3>
        </section>

        <section>
          <h2>one-to-one 4</h2>
          <pre><code data-trim>
class Face {
  static hasOne = [ nose:Nose ]
}
class Nose {
  Face face
}
          </code></pre>
          <ul>
            <li>bidirectional (Face <-> Nose)</li>
            <li>one-to-one</li>
          </ul>
        </section>

        <section>
          <h2>Database</h2>
          <pre><code data-trim>
mysql> describe face;
+---------+------------+------+-----+---------+----------------+
| Field   | Type       | Null | Key | Default | Extra          |
+---------+------------+------+-----+---------+----------------+
| id      | bigint(20) | NO   | PRI | NULL    | auto_increment |
| version | bigint(20) | NO   |     | NULL    |                |
+---------+------------+------+-----+---------+----------------+

mysql> describe nose;
+---------+------------+------+-----+---------+----------------+
| Field   | Type       | Null | Key | Default | Extra          |
+---------+------------+------+-----+---------+----------------+
| id      | bigint(20) | NO   | PRI | NULL    | auto_increment |
| version | bigint(20) | NO   |     | NULL    |                |
| face_id | bigint(20) | NO   | UNI | NULL    |                |
+---------+------------+------+-----+---------+----------------+
          </code></pre>
        </section>

        <section>
          <h2>one-to-many</h2>
          <pre><code data-trim>
class Author {
  static hasMany = [ books:Book ]
  
  String name
}
class Book {
  String title
}
          </code></pre>
          <ul>
            <li>unidirectional (Author -> Book)</li>
            <li>one-to-many (An author can have many books)</li>
            <li>mapped with a join table by default</li>
          </ul>
        </section>

        <section>
          <h2>Database</h2>
          <pre><code data-trim>
mysql> describe author;
+---------+--------------+------+-----+---------+----------------+
| Field   | Type         | Null | Key | Default | Extra          |
+---------+--------------+------+-----+---------+----------------+
| id      | bigint(20)   | NO   | PRI | NULL    | auto_increment |
| version | bigint(20)   | NO   |     | NULL    |                |
| name    | varchar(255) | NO   |     | NULL    |                |
+---------+--------------+------+-----+---------+----------------+

mysql> describe book;
+---------+--------------+------+-----+---------+----------------+
| Field   | Type         | Null | Key | Default | Extra          |
+---------+--------------+------+-----+---------+----------------+
| id      | bigint(20)   | NO   | PRI | NULL    | auto_increment |
| version | bigint(20)   | NO   |     | NULL    |                |
| title   | varchar(255) | NO   |     | NULL    |                |
+---------+--------------+------+-----+---------+----------------+

mysql> describe author_book;
+-----------------+------------+------+-----+---------+-------+
| Field           | Type       | Null | Key | Default | Extra |
+-----------------+------------+------+-----+---------+-------+
| author_books_id | bigint(20) | YES  | MUL | NULL    |       |
| book_id         | bigint(20) | YES  | MUL | NULL    |       |
+-----------------+------------+------+-----+---------+-------+
          </code></pre>
        </section>

        <section>
          <h2>Example</h2>
          <pre><code data-trim>
import tutorial.*

def a = new Author(name: 'Tolkien')

a.addToBooks(title: 'The Hobbit')
a.addToBooks(title: 'The Lord of the Rings')
a.save()

a.books.each {
  println it.title
}
          </code></pre>
        </section>

        <section>
          <h2>Database</h2>
          <pre><code data-trim>
mysql> select * from author;
+----+---------+---------+
| id | version | name    |
+----+---------+---------+
|  1 |       0 | Tolkien |
+----+---------+---------+

mysql> select * from book;
+----+---------+-----------------------+
| id | version | title                 |
+----+---------+-----------------------+
|  1 |       0 | The Lord of the Rings |
|  2 |       0 | The Hobbit            |
+----+---------+-----------------------+

mysql> select * from author_book;
+-----------------+---------+
| author_books_id | book_id |
+-----------------+---------+
|               1 |       1 |
|               1 |       2 |
+-----------------+---------+
          </code></pre>
        </section>

        <section>
          <h2>Behavior</h2>
          <pre><code data-trim>
// save/update are cascaded
// deletes are not cascaded
import tutorial.*

def a = Author.get(1)

a.delete()

Author.list().size()    // 0
Book.list().size()      // 2
          </code></pre>
        </section>

        <section>
          <h2>Database</h2>
          <pre><code data-trim>
mysql> select * from author;
Empty set (0.00 sec)

mysql> select * from book;
+----+---------+-----------------------+
| id | version | title                 |
+----+---------+-----------------------+
|  1 |       0 | The Lord of the Rings |
|  2 |       0 | The Hobbit            |
+----+---------+-----------------------+
2 rows in set (0.00 sec)

mysql> select * from author_book;
Empty set (0.00 sec)
          </code></pre>
        </section>

        <section>
          <h2>one-to-many 2</h2>
          <pre><code data-trim>
class Author {
  static hasMany = [ books:Book ]

  String name
}
class Book {
  static belongsTo =  [ author:Author ]

  String title
}
          </code></pre>
          <ul>
            <li>bidirectional (Author <-> Book)</li>
            <li>one-to-many (An author can have many books, a book has only an author)</li>
          </ul>
        </section>

        <section>
          <h2>Database</h2>
          <pre><code data-trim>
mysql> describe author;
+---------+--------------+------+-----+---------+----------------+
| Field   | Type         | Null | Key | Default | Extra          |
+---------+--------------+------+-----+---------+----------------+
| id      | bigint(20)   | NO   | PRI | NULL    | auto_increment |
| version | bigint(20)   | NO   |     | NULL    |                |
| name    | varchar(255) | NO   |     | NULL    |                |
+---------+--------------+------+-----+---------+----------------+

mysql> describe book;
+-----------+--------------+------+-----+---------+----------------+
| Field     | Type         | Null | Key | Default | Extra          |
+-----------+--------------+------+-----+---------+----------------+
| id        | bigint(20)   | NO   | PRI | NULL    | auto_increment |
| version   | bigint(20)   | NO   |     | NULL    |                |
| author_id | bigint(20)   | NO   | MUL | NULL    |                |
| title     | varchar(255) | NO   |     | NULL    |                |
+-----------+--------------+------+-----+---------+----------------+
          </code></pre>
        </section>

        <section>
          <h2>Example</h2>
          <pre><code data-trim>
import tutorial.*

def a = new Author(name: 'Tolkien')
def b = new Book(title: 'The Hobbit')
def b2 = new Book(title: 'The Lord of the Rings')

a.addToBooks(b)
a.addToBooks(b2)
a.save()

println(a.books.size())    // 2
a.books.each {
  println it.title
}
// The Hobbit
// The Lord of the Rings
println b.author.name   // Tolkien
println b2.author.name  // Tolkien
          </code></pre>
        </section>

        <section>
          <h2>Database</h2>
          <pre><code data-trim>
mysql> select * from author;
+----+---------+---------+
| id | version | name    |
+----+---------+---------+
|  1 |       0 | Tolkien |
+----+---------+---------+

mysql> select * from book;
+----+---------+-----------+-----------------------+
| id | version | author_id | title                 |
+----+---------+-----------+-----------------------+
|  1 |       0 |         1 | The Hobbit            |
|  2 |       0 |         1 | The Lord of the Rings |
+----+---------+-----------+-----------------------+
          </code></pre>
        </section>

        <section>
          <h2>many-to-many</h2>
          <pre><code data-trim>
class Book {
  static belongsTo = Author
  static hasMany = [ authors:Author ]

  String title
}
class Author {
  static hasMany = [ books:Book ]
  
  String name
}
          </code></pre>
          <ul>
            <li>hasMany on both sides</li>
            <li>belongsTo on the owned (subordinated) side of the relationship</li>
            <li>owning side takes responsibility for persisting relationship</li>
            <li>owning side cascade saves</li>
            <li>use a join table</li>
          </ul>
        </section>

        <section>
          <h2>Example</h2>
          <pre><code data-trim>
import tutorial.*

new Author(name: 'Tolkien')
    .addToBooks(new Book(title: 'The Hobbit'))
    .addToBooks(new Book(title: 'The Lord of the Rings'))
    .save()
    
println Author.list().size()    // 1 
println Book.list().size()      // 2
          </code></pre>
        </section>

        <section>
          <h2>Database</h2>
          <pre><code data-trim>
mysql> select * from author;
+----+---------+---------+
| id | version | name    |
+----+---------+---------+
|  1 |       0 | Tolkien |
+----+---------+---------+

mysql> select * from book;
+----+---------+-----------------------+
| id | version | title                 |
+----+---------+-----------------------+
|  1 |       0 | The Hobbit            |
|  2 |       0 | The Lord of the Rings |
+----+---------+-----------------------+

mysql> select * from author_books;
+-----------+---------+
| author_id | book_id |
+-----------+---------+
|         1 |       1 |
|         1 |       2 |
+-----------+---------+
          </code></pre>
        </section>

        <section>
          <h2>Example</h2>
          <pre><code data-trim>
import tutorial.*

new Book(title: 'The C programming language')
    .addToAuthors(name: 'Kernighan')
    .addToAuthors(name: 'Ritchie')
    .save()
    
println Author.list().size()    // 1 
println Book.list().size()      // 3
          </code></pre>
        </section>

        <section>
          <h2>Database</h2>
          <pre><code data-trim>
mysql> select * from author;
+----+---------+---------+
| id | version | name    |
+----+---------+---------+
|  1 |       0 | Tolkien |
+----+---------+---------+

mysql> select * from book;
+----+---------+----------------------------+
| id | version | title                      |
+----+---------+----------------------------+
|  1 |       0 | The Hobbit                 |
|  2 |       0 | The Lord of the Rings      |
|  3 |       0 | The C programming language |
+----+---------+----------------------------+

mysql> select * from author_books;
+-----------+---------+
| author_id | book_id |
+-----------+---------+
|         1 |       1 |
|         1 |       2 |
+-----------+---------+
          </code></pre>
        </section>

        <section>
          <h2>Save/Update</h2>
          <pre><code data-trim>
def p = Person.get(1)
p.name = "Bob"
p.save()

// no SQL update guaranteed in that point
// Hibernate batches SQL statements

def p = Person.get(1)
p.name = "Bob"
p.save(flush: true)       // Forces a synchronization with DB

// Handling exceptions on saving
def p = Person.get(1)
try {
    p.save(flush:true)
}
catch(Exception e) {
    // deal with exception
}
          </code></pre>
        </section>

        <section>
          <h2>Delete</h2>
          <pre><code data-trim>
def p = Person.get(1)
p.delete()

// same as save/update

def p = Person.get(1)
p.delete(flush:true)      // Forces synchronization with DB

// Handling exceptions
def p = Person.get(1)
try {
  p.delete(flush:true) 
} catch(org.springframework.dao.DataIntegrityViolationException e) {
  // deal with exception
}
          </code></pre>
        </section>

        <section>
          <h2>Tips</h2>
          <p><a href="http://spring.io/blog/2010/06/23/gorm-gotchas-part-1">http://spring.io/blog/2010/06/23/gorm-gotchas-part-1</a></p>
          <p><a href="http://spring.io/blog/2010/07/02/gorm-gotchas-part-2">http://spring.io/blog/2010/07/02/gorm-gotchas-part-2</a></p>
          <p><a href="http://spring.io/blog/2010/07/28/gorm-gotchas-part-3">
http://spring.io/blog/2010/07/28/gorm-gotchas-part-3</a></p>
        </section>

        <section>
          <h2>Eager and lazy fetching</h2>
          <pre><code data-trim>
// by default lazy

class Location {
  String city
}
class Author {
  String name
  Location location
}
Author.list().each { author ->
  println author.location.city
}

// If there are N = 4 authors
// 1 query to fetch all authors
// 1 query per author to get the location (because we're printing the city)
// Total = 4 + 1 = N + 1 querys
          </code></pre>
        </section>

        <section>
          <h2>Eager loading</h2>
          <pre><code data-trim>
class Author {
  String name
  Location location

  static mapping = {
    location fetch: 'join'
  }
}

Author.list(fetch: [location: 'join']).each { a -> 
  println a.location.city
}
          </code></pre>
        </section>

        <section>
          <h2>Eager loading</h2>
          <pre><code data-trim>
// Dynamic finders
Author.findAllByNameLike("John%", 
  [ sort: 'name', 
    order: 'asc', 
    fetch: [location: 'join'] ]).each { a ->
  // ...
}

// Criteria queries
def authors = Author.withCriteria {
  like("name", "John%")
  join "location"
}
          </code></pre>
        </section>

        <section>
          <h2>Querying</h2>
          <pre><code data-trim>
// list
def books = Book.list()
def books = Book.list(offset:10, max:20)
def books = Book.list(sort:"title", order: "desc")

// retrieval
def b = Book.get(23)
def list = Book.getAll(1,3,24)
          </code></pre>
        </section>

        <section>
          <h2>Dynamic finders</h2>
          <pre><code data-trim>
class Book {
  String title
  Date releaseDate
  Author author
}
class Author {
  String name
}

def b
b = Book.findByTitle("The Hobbit")
b = Book.findByTitleLike("%Hobb%")
b = Book.findByReleaseDateBetween(firstDate, secondDate)
b = Book.findByReleaseDateGreaterThan(someDate)
b = Book.findByTitleLikeOrReleaseDateLessThan("%obbi%", someDate)
b = Book.findByReleaseDateIsNull()
b = Book.findByReleaseDateIsNotNull()
b = Book.findAllByTitleLike("The %", 
    [max:3, offset:10, sort: "title", order: "desc"])
          </code></pre>
        </section>

        <section>
          <h2>Criteria</h2>
          <pre><code data-trim>
def c = Book.createCriteria()
def results = c {
  eq("releaseDate", someDate)
  or {
    like("title", "%programming%")
    like("title", "%Ring%")
  }
  maxResults(100)
  order("title", "desc")
}
          </code></pre>
        </section>

        <section>
          <h2>HQL</h2>
          <pre><code data-trim>
def list = Book.findAll(
  "from Book as b where b.title like 'Lord of the%'")
def list = Book.findAll(
  "from Book as b where b.author = ?",
  [author])
def list = Book.findAll(
  "from Book as b where b.author = :author",
  [author:someAuthor])
          </code></pre>
        </section>

        <section>
          <h1>Controllers</h1>
        </section>

        <section>
          <h2>Controllers</h2>
          <ul>
            <li>handle request</li>
            <li>create response</li>
              <ul>
                <li>can generate the response</li>
                <li>delegate to a view</li>
              </ul>
            </li>
            <li>scope: request (a <strong>new</strong> instance is created for each client request)</li>
            <li>Class with Controller suffix</li>
            <li>grails-app/controllers</li>
          </ul>
        </section>

        <section>
          <h2>Create controller</h2>
          <pre><code data-trim>
$ grails create-controller book     // default package: tutorial
          </code></pre>
        </section>

        <section>
          <h3>grails-app/controllers/tutorial/BookController.groovy</h3>
          <pre><code data-trim>
package tutorial

class BookController {
  def index = {}
}

// mapped to /book URI
          </code></pre>
        </section>

        <section>
          <h2>Controller actions</h2>
          <pre><code data-trim>
// properties that are assigned a block of code
// each property maps to an URI
// public by default

class BookController {
  def list = {
    // some statements
  }
}

// maps to /book/list
          </code></pre>
        </section>

        <section>
          <h2>Default action</h2>
          <pre><code data-trim>
static defaultAction = "list"
          </code></pre>
          <ol>
            <li>if only one action exists, the default URI maps to it</li>
            <li>if an index action exists, it handle requests when no action specified</li>
            <li>explicit declaration</li>
          </ol>
        </section>

        <section>
          <h2>Scopes</h2>
          <ul>
            <li><strong>servletContext</strong>: application wide</li>
            <li><strong>session</strong>: session of a user</li>
            <li><strong>request</strong>: current request</li>
            <li><strong>params</strong>: _mutable_ map of incoming request params</li>
            <li><strong>flash</strong>: only for this request and the subsequent (e.g. set a message before redirect)</li>
          </ul>
        </section>

        <section>
          <h2>Accessing scopes</h2>
          <pre><code data-trim>
class BookController {
  def find = {
    def findBy = params["findBy"]
    def userAgent = request.getHeader("User-Agent")       
    def loggedUser = session["logged_user"] 
        // session.logged_user
  }
  
  def delete = {
    def b = Book.get( params.id )
    if(!b) {
        flash.message = "User not found for id ${params.id}"
        redirect(action:list)
      }
    }
  }
}
          </code></pre>
        </section>

        <section>
          <h1>Models and views</h1>
        </section>

        <section>
          <h2>Model</h2>
          <ul>
            <li>Map of objects that the view uses to render the response</li>
            <li>Keys of map translate to variables in the view</li>
          </ul>
        </section>

        <section>
          <h2>Explicit return of model</h2>
          <pre><code data-trim>
def show = {
  [ book: Book.get(params.id) ]
}
          </code></pre>
        </section>

        <section>
          <h2>Implicit return of model</h2>
          <pre><code data-trim>
class BookController {
  List books
  List authors
  
  def list = {
    books = Book.list()
    authors = Author.list()
  }
}
          </code></pre>
        </section>

        <section>
          <h2>Implicit view</h2>
          <pre><code data-trim>
class BookController {
  def show = {
    [ book:Book.get(params.id) ]
  }
}
          </code></pre>
          <h3>Grails looks for view at</h3>
          <ul>
            <li>grails-app/views/book/show.jsp</li>
            <li>grails-app/views/book/show.gsp</li>
          </ul>
        </section>

        <section>
          <h2>Explicit view</h2>
          <pre><code data-trim>
def show = {
  def map = [ book: Book.get(1) ]
  render(view: "display", model: map)
}
          </code></pre>
          <h3>Grails will try</h3>
          <ul>
            <li>grails-app/views/book/display.jsp</li>
            <li>grails-app/views/book/display.gsp</li>
          </ul>
          <pre><code data-trim>
    def show = {
      def map = [ book: Book.get(1) ]
      render(view: "/shared/display", model: map)
    }
          </code></pre>
          <h3>Grails will try</h3>
          <ul>
            <li>grails-app/views/shared/display.jsp</li>
            <li>grails-app/views/shared/display.gsp</li>
          </ul>
 
        </section>

        <section>
          <h2>Direct rendering of the response</h2>
          <pre><code data-trim>
class BookController {
  def greet = {
    render "hello!"
  }
}
          </code></pre>
        </section>

        <section>
          <h2>Redirect</h2>
          <pre><code data-trim>
class BookController {
  def greet = {
    render "hello!"
  }

  def redirect     = {
    redirect(action: greet)
  }
}
          </code></pre>
        </section>

        <section>
          <h2>Redirect expects</h2>
          <h3>other closure on the same class</h3>
          <pre><code data-trim>
redirect(action:list)
          </code></pre>
          <h3>controller and action</h3>
          <pre><code data-trim>
redirect(controller: 'author', action: 'list')
          </code></pre>
          <h3>URI </h3>
          <pre><code data-trim>
redirect(uri: "/help.html")
          </code></pre>
          <h3>URL</h3>
          <pre><code data-trim>
redirect(url: 'http://yahoo.com')
          </code></pre>
        </section>

        <section>
          <h2>Data binding</h2>
          <pre><code data-trim>
// implicit constructor
def save = {
  def b = new Book(params)
  b.save()
}

// explicit binding
def save = {
  def b = Book.get(params.id)
  b.properties = params   // sets every parameter 
                          // as a property in the object
  b.someParam = params.foo   // only some parameters are set
  b.otherParam = params.bar
  b.save()
}
          </code></pre>
        </section>

        <section>
          <h1>JSON and XML responses</h1>
        </section>

        <section>
          <h2>XML</h2>
          <pre><code data-trim>
def listXML = {
  def results = Book.list()
  render(contentType: 'text/xml') {
    books {
      for(b in results) {
        book(title: b.title)
      }
    }
  }
}
          </code></pre>
        </section>

        <section>
          <h2>Output</h2>
          <pre><code data-trim>
<books>
  <book title="title one"></book>
  <book title="title two"></book>
</books>
          </code></pre>
        </section>

        <section>
          <h2>JSON</h2>
          <pre><code data-trim>
def listJSON = {
  def results = Book.list()
  render(contentType: 'text/json') {
    books = array {
      for(b in results) {
        book(title: b.title)
      }
    }
  }
}
          </code></pre>
        </section>

        <section>
          <h2>Output</h2>
          <pre><code data-trim>
"books":[
  {"title": "title one"},
  {"title": "title two"}
]
          </code></pre>
        </section>

        <section>
          <h1>Automatic XML and JSON marshaling</h1>
        </section>

        <section>
          <h2>XML</h2>
          <pre><code data-trim>
import grails.converters.*

def list = {
  render Book.list() as XML
}

def list2 = {
  render Book.list().encodeAsXML() // using codecs
}
          </code></pre>
        </section>

        <section>
          <h2>JSON</h2>
          <pre><code data-trim>
render Book.list() as JSON

render Book.list().encodeAsJSON()
          </code></pre>
        </section>

        <section>
          <h2>Type converters</h2>
          <pre><code data-trim>
def total = params.int('total')
def checked = params.boolean('checked')
          </code></pre>
          <ul>
            <li>null safe</li>
            <li>safe from parsing errors</li>
          </ul>
        </section>

        <section>
          <h1>Groovy Server Pages</h1>
        </section>

        <section>
          <h2>GSP</h2>
          <ul>
            <li>similar to ASP, JSP</li>
            <li>more flexible</li>
            <li>live in grails-app/views</li>
            <li>rendered automatically (by convention) or with the render method</li>
            <li>Mark-up (HTML) and GSP tags</li>
            <li>embedded logic possible but _discouraged_</li>
            <li>uses the model passed by the controller action</li>
          </ul>
        </section>

        <section>
          <h2>Controller</h2>
          <pre><code data-trim>
// returns a model with key called book.
def show = {
  [ book: Book.get(1) ]
}
          </code></pre>
        </section>

        <section>
          <h2>View</h2>
          <pre><code data-trim>
<%-- the key named book from the model is referenced by 
    name in the gsp --%>
<%= book.title %>
          </code></pre>
        </section>

        <section>
          <h2>GSP Basics</h2>
          <pre><code data-trim>
&lt;% %&gt; blocks  to embed groovy code (discouraged)

&lt;html&gt;
  &lt;body&gt;
    &lt;% out &lt;&lt; &quot;Hello world!&quot; %&gt;
    &lt;%= &quot;this is equivalent&quot; %&gt;
  &lt;/body&gt;
&lt;/html&gt;
          </code></pre>
        </section>

        <section>
          <h2>Variables in GSPs</h2>
          <pre><code data-trim>
<% now = new Date() %>
  ...
<p>Time: <%= now %></p>

<!--   
  predefined:
  - application
  - applicationContext
  - flash
  - grailsApplication
  - out
  - params
  - request
  - response
  - session
  - webRequest
-->
          </code></pre>
        </section>

        <section>
          <h2>GSP Expressions</h2>
          <pre><code data-trim>
&lt;html&gt;
  &lt;body&gt;
    Hello ${params.name}
    Time is: ${new Date()}
    2 + 2 is: ${ 2 + 2 }
    but also: ${ /* any valid groovy statement */ }
  &lt;/body&gt;
&lt;/html&gt;
          </code></pre>
        </section>

        <section>
          <h2>GSP built-in tags</h2>
          <pre><code data-trim>
&lt;g:example param=&quot;a string param&quot;
  otherParam=&quot;${new Date()}&quot; 
  aMap=&quot;[aString:'a string', aDate: new Date()]&quot;&gt;
  Hello world
&lt;/g:example&gt;
          </code></pre>
          <ul> 
            <li>start with g: prefix</li>
            <li>no need to import tag libraries</li>
          </ul>
        </section>

        <section>
          <h2>&lt;g:set/&gt;</h2>
          <pre><code data-trim>
&lt;g:set var=&quot;myVar&quot; value=&quot;${new Date()}&quot;/&gt;

&lt;g:set var=&quot;myText&quot;&gt;
  some text with expressions ${myVar}
&lt;/g:set&gt;
&lt;p&gt;${myText}&lt;/p&gt;
          </code></pre>
        </section>

        <section>
          <h2>Logic/Iteration</h2>

          <pre><code data-trim>
&lt;g:if test=&quot;${1 &gt; 3}&quot;&gt;
  some html
&lt;/g:if&gt;
&lt;g:else&gt;
  something else
&lt;/g:else&gt;

&lt;g:each in=&quot;${tutorial.Book.list()}&quot; var=&quot;b&quot;&gt;
  title: ${b.title}
&lt;/g:each&gt;
                                                     
&lt;g:set var=&quot;n&quot; value=&quot;${0}&quot;/&gt;
&lt;g:while test=&quot;${n&lt;5}&quot;&gt;
  ${n++}         
&lt;/g:while&gt;
          </code></pre>
        </section>

        <section>
          <h2>Links and resources</h2>
          <pre><code data-trim>
&lt;g:link action=&quot;show&quot; id=&quot;2&quot;&gt;Item 2&lt;/g:link&gt;
&lt;g:link controller=&quot;user&quot; action=&quot;list&quot;&gt;Users&lt;/g:link&gt;
          </code></pre>
        </section>

        <section>
          <h2>Forms and fields</h2>
          <pre><code data-trim>
&lt;g:form name=&quot;myForm&quot; 
      url=&quot;[controller:'book', action:'submit']&quot;&gt;
  Text: &lt;g:textField name=&quot;text&quot;/&gt;
  &lt;g:submitButton name=&quot;button&quot; value=&quot;Submit form&quot;/&gt;
&lt;/g:form&gt;
          </code></pre>
          <ul>
            <li>textField</li>
            <li>checkbox</li>
            <li>radio</li>
            <li>hiddenField</li>
            <li>select</li>
            <li>submitButton</li>
          </ul>
        </section>

        <section>
          <h1>Tags and method calls</h1>
        </section>

        <section>
          <h2>In views</h2>
          <pre><code data-trim>
Static Resource: ${createLinkTo(dir:&quot;images&quot;, file:&quot;logo.jpg&quot;)}

&lt;img src=&quot;${createLinkTo(dir:'images', file:'logo.jpg')}&quot; /&gt;
          </code></pre>
        </section>

        <section>
          <h2>In controllers and taglibs</h2>
          <pre><code data-trim>
def imageLocation = createLinkTo(dir:"images", file:"logo.jpg")        
def imageLocation = g.createLinkTo(dir:"images", file:"logo.jpg")
          </code></pre>
        </section>

        <section>
          <h2>Templates</h2>
          <ul>
            <li>maintainable and reusable chunks of views</li>
            <li>name starts with a underscore: _myTemplate.gsp</li>
          </ul>
        </section>

        <section>
          <h2>grails-app/views/book/_info.gsp</h2>
          <pre><code data-trim>
&lt;div class=&quot;book&quot; id=&quot;${book.id}&quot;&gt;
  Title: ${book.title}
&lt;/div&gt;
          </code></pre>
        </section>

        <section>
          <h2>From other view</h2>
          <pre><code data-trim>
&lt;g:render template=&quot;info&quot; 
    var=&quot;book&quot; 
    collection=&quot;${tutorial.Book.list()}&quot;/&gt;
          </code></pre>
        </section>

        <section>
          <h2>From controller</h2>
          <pre><code data-trim>
def useTemplate = {
  def b = Book.get(1)
  render(template: "info", model: [ book:b ])
}
          </code></pre>
        </section>

        <section>
          <h1>GSP debugging</h1>
        </section>

        <section>
          <h2>GSPs</h2>
          <p>Add "showSource=true" to the url. Only in development mode</p>
        </section>

        <section>
          <h2>Templates</h2>
          <p>Add "debugTemplates" to the url. Only in development mode</p>
        </section>

        <section>
          <h1>Tag libraries</h1>
        </section>

        <section>
          <h2>Tag libraries</h2>
          <ul>
            <li>groovy class that ends with TagLib</li>
            <li>live in grails-app/taglib</li>
            <li>$ grails create-tag-lib utils</li>
            <li>implicit out variable. Refers to the output Writer</li>
          </ul>
        </section>

        <section>
          <h2>Taglibs 1</h2>
          <h3>Taglib</h3>
          <pre><code data-trim>
class UtilsTagLib {
  def copyright = { attrs, body ->
    out << "&copy; Copyright 2014"
  }
}
          </code></pre>
          <h3>GSP</h3>
          <pre><code data-trim>
&lt;div&gt;&lt;g:copyright/&gt;&lt;/div&gt;
          </code></pre>

          <h3>HTML</h3>
          <pre><code data-trim>
&lt;div&gt;&copy; Copyright 2014&lt;/div&gt;
          </code></pre>
        </section>

        <section>
          <h2>Example 2</h2>
          <h3>Taglib</h3>
          <pre><code data-trim>
import java.text.*

def dateFormat = { attrs, body ->
  def fmt = new SimpleDateFormat(attrs.format)
  out << fmt.format(attrs.date)
}
          </code></pre>
          <h3>GSP</h3>
          <pre><code data-trim>
Date: &lt;g:dateFormat format=&quot;dd-MM-yyyy&quot; date=&quot;${new Date()}&quot;/&gt;
          </code></pre>
          <h3>HTML</h3>
          <pre><code data-trim>
Date: 23-04-2014
          </code></pre>
        </section>

        <section>
          <h2>Example 3</h2>
          <h3>Taglib</h3>
          <pre><code data-trim>
def formatBook = { attrs, body ->
  out << render(template: "info", model: [ book:attrs.book ])
}
          </code></pre>
          <h3>GSP</h3>
          <pre><code data-trim>
&lt;div&gt;&lt;g:formatBook book=&quot;${tutorial.Book.get(1)}&quot;/&gt;&lt;/div&gt;
          </code></pre>
          <h3>View</h3>
          <pre><code data-trim>
&lt;div&gt;
&lt;div class=&quot;book&quot; id=&quot;1&quot;&gt;
  Title: Some title
&lt;/div&gt;
&lt;/div&gt;
          </code></pre>
        </section>

        <section>
          <h1>AJAX</h1>
        </section>

        <section>
          <h2>Javascript</h2>
          <pre><code data-trim>
&lt;head&gt;
  &lt;g:javascript library=&quot;prototype&quot;/&gt;
  &lt;g:javascript library=&quot;scriptaculous&quot;/&gt;
&lt;/head&gt;
          </code></pre>
        </section>

        <section>
          <section>
            <h2>Remote link</h2>
          </section>
          <section>
            <h3>View</h3>
            <pre><code data-trim>
    &lt;g:remoteLink action=&quot;delete&quot; id=&quot;1&quot;&gt;
    Delete Book
    &lt;/g:remoteLink&gt;
            </code></pre>
            <p>asynchronous request to the delete action of the current controller with an id parameter with value of 1</p>
          </section>
          <section>
            <h3>Controller</h3>
            <pre><code data-trim>
class AjaxController {
  def index = {}

  def delete = {
    def b = Book.get(params.id)
    b.delete()
    render "Book ${b.title} was deleted"
  }
}
            </code></pre>
          </section>
        </section>

        <section>
          <section>
            <h2>Independent updates for failure and success</h2>
          </section>
          <section>
            <h3>View</h3>
            <pre><code data-trim>
Success: &lt;div id=&quot;success&quot;&gt;&lt;/div&gt;
Failure: &lt;div id=&quot;error&quot;&gt;&lt;/div&gt;
&lt;g:remoteLink action=&quot;success&quot; 
      update=&quot;[success:'success', failure:'error']&quot;&gt;
  Success ajax request
&lt;/g:remoteLink&gt;&lt;br/&gt;
&lt;g:remoteLink action=&quot;failure&quot; 
      update=&quot;[success:'success', failure:'error']&quot;&gt;
  Failure ajax request
&lt;/g:remoteLink&gt;
            </code></pre>
          </section>
          <section>
            <h3>Controller</h3>
            <pre><code data-trim>
def success = {
  render status:200, text:"request OK"
}

def failure = {
  render status:503, text:"request failed"
}
            </code></pre>
          </section>
        </section>

        <section>
          <section>
            <h2>Ajax form submission</h2>
          </section>
          <section>
            <h3>View</h3>
            <pre><code data-trim>
&lt;g:formRemote url=&quot;[controller:'ajax', action:'ajaxAdd']&quot;
      name=&quot;ajaxForm&quot;
      update=&quot;[success:'addSuccess', failure:'addError']&quot;&gt;
  Book title:  &lt;input type=&quot;text&quot; name=&quot;title&quot;/&gt;
  &lt;input type=&quot;submit&quot; value=&quot;Add Book!&quot; /&gt;
&lt;/g:formRemote &gt;
&lt;div id=&quot;addSuccess&quot;&gt;&lt;/div&gt;
&lt;div id=&quot;addError&quot;&gt;&lt;/div&gt;
            </code></pre>
          </section>
          <section>
            <h3>Controller</h3>
            <pre><code data-trim>
def ajaxAdd = {
  def b = new Book(params)
  b.save()
  render "Book '${b.title}' created"
}
            </code></pre>
          </section>
        </section>

        <section>
          <section>
            <h2>Ajax returning content</h2>
          </section>
          <section>
            <h3>View</h3>
            <pre><code data-trim>
&lt;g:remoteLink action=&quot;ajaxContent&quot;
      update=&quot;book&quot;&gt;
  Update Content
&lt;/g:remoteLink&gt;
&lt;div id=&quot;book&quot;&gt;&lt;!--existing book mark-up --&gt;&lt;/div&gt;
            </code></pre>
          </section>
          <section>
            <h3>Controller</h3>
            <pre><code data-trim>
def ajaxContent = {
  def b = Book.get(2)
  render "Book: <strong>${b.title}</strong> found at ${new Date()}!"
}
            </code></pre>
          </section>
        </section>

        <section>
          <section>
            <h2>Ajax returning JSON</h2>
          </section>
          <section>
            <h3>View</h3>
            <pre><code data-trim>
&lt;g:javascript&gt;
  function updateBook(e) {
    // evaluate the JSON
    var book = eval(&quot;(&quot;+e.responseText+&quot;)&quot;)
    $(&quot;book_title&quot;).innerHTML = book.title
  }
&lt;/g:javascript&gt;
&lt;g:remoteLink action=&quot;ajaxData&quot; 
      update=&quot;foo&quot; 
      onSuccess=&quot;updateBook(e)&quot;&gt;
  Update Book with JSON
&lt;/g:remoteLink&gt;
&lt;div id=&quot;book&quot;&gt;
  &lt;div id=&quot;book_title&quot;&gt;The Hobbit&lt;/div&gt;
&lt;/div&gt;
            </code></pre>
          </section>
          <section>
            <h3>Controller</h3>
            <pre><code data-trim>
import grails.converters.*

def ajaxData = {
  def b = new Book(title: 'new book title').save()
  render b as JSON
}
            </code></pre>
          </section>
        </section>




        <section>
          <h1>Version control</h1>
        </section>

        <section>
          <section>
            <h2>Subversion</h2>
          </section>
          <section>
            <h2>Create repository</h2>
            <pre><code data-trim>
$ svnadmin create /home/miguel/repo
$ svn list file:///home/miguel/repo
            </code></pre>
          </section>
          <section>
            <h2>Create empty dir in repository (remote create)</h2>
            <pre><code data-trim>
$ svn mkdir file:///home/miguel/repo/GrailsProject
$ svn mkdir file:///home/miguel/repo/GrailsProject/branches
$ svn mkdir file:///home/miguel/repo/GrailsProject/tags
$ svn mkdir file:///home/miguel/repo/GrailsProject/trunk
            </code></pre>
          </section>
          <section>
            <h2>Create grails project (local)</h2>
            <pre><code data-trim>
$ grails create-app GrailsProject
            </code></pre>
          </section>
          <section>
            <h2>Add grails code to working copy, inline</h2>
            <pre><code data-trim>
$ cd GrailsProject
$ svn co file:///home/miguel/repo/GrailsProject/trunk .
$ svn add .classpath .settings .project *
$ svn propset svn:ignore "WEB-INF" web-app/
$ svn propset svn:ignore "target" .
$ svn rm --force web-app/WEB-INF
$ svn commit -m "First commit of GrailsProject"
            </code></pre>
          </section>
          <section>
            <h2>Checkout</h2>
            <pre><code data-trim>
$ cd ..
$ svn co file:///home/miguel/repo/GrailsProject/trunk OtherUserGrailsProject
$ cd OtherUserGrailsProject
$ grails upgrade
            </code></pre>
          </section>
        </section>

        <section>
          <section>
            <h1>Git</h1>
          </section>
          <section>
            <h2>Create repository</h2>
            <pre><code data-trim>
$ grails create-app GrailsProject
$ cd GrailsProject
$ git init

.gitignore:
web-app/WEB-INF/
target/

$ git add .
$ git commit -m "First commit on GrailsProject"    
            </code></pre>
          </section>
          <section>
            <h2>Clone</h2>
            <pre><code data-trim>
$ cd ..
$ git clone GrailsProject OtherUserGrailsProject
$ cd OtherUserGrailsProject
$ grails upgrade
            </code></pre>
          </section>
        </section>

        <section>
          <h1>Thanks!</h1>
          <p>Miguel CobÃ¡</p>
          <p><a href="http://miguel.leugim.com.mx">http://miguel.leugim.com.mx</a></p>
          <p>Github: <a href="http://github.com/miguelcoba">miguelcoba</a></p>
          <p><a href="mailto:miguel.coba@gmail.com">miguel.coba@gmail.com</a></p>
        </section>

      </div>

    </div>

    <script src="revealjs/lib/js/head.min.js"></script>
    <script src="revealjs/js/reveal.min.js"></script>

    <script>

      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
        transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

        // Optional libraries used to extend on reveal.js
        dependencies: [
          { src: 'revealjs/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'revealjs/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'revealjs/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'revealjs/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'revealjs/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
          { src: 'revealjs/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
        ]
      });

    </script>

  </body>
</html>
